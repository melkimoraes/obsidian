`DECLARE
V_ALTURA NUMBER;
V_ESPESSURA NUMBER;
V_LARGURA NUMBER;
V_M3 NUMBER;
V_TALTURA NUMBER;
V_TESPESSURA NUMBER;
V_TLARGURA NUMBER;
V_TM3 NUMBER;
BEGIN
  FOR X IN (SELECT CODPROD FROM TGFPRO WHERE AD_TIPO='PK')LOOP
          V_TALTURA := 0;
          V_TESPESSURA := 0;
          V_TLARGURA := 0;
          V_TM3 := 0;
        FOR Y IN (SELECT CODMATPRIMA FROM TGFICP WHERE CODPROD = X.CODPROD) LOOP
          SELECT ALTURA,ESPESSURA,LARGURA,M3 
          INTO V_ALTURA, V_ESPESSURA, V_LARGURA, V_M3
          FROM TGFPRO WHERE CODPROD = Y.CODMATPRIMA;
          
          V_TALTURA := V_TALTURA + V_ALTURA;
          V_TESPESSURA := V_TESPESSURA + V_ESPESSURA;
          V_TLARGURA := V_TLARGURA + V_LARGURA;
          V_TM3 := V_TM3 + V_M3;
        END LOOP;
        
      UPDATE TGFPRO SET UNIDADE='CM',ALTURA=V_TALTURA,ESPESSURA=V_TESPESSURA,LARGURA=V_TLARGURA,M3=V_TM3 WHERE CODPROD=X.CODPROD;
      COMMIT;
  END LOOP;
END;`

